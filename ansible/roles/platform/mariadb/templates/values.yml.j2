# MariaDB Helm Values
# Generated by Ansible

image:
  tag: {{ mariadb_version }}

auth:
  existingSecret: mariadb-credentials
  database: {{ mariadb_database }}

primary:
  resources:
    requests:
      cpu: {{ mariadb_resources.requests.cpu }}
      memory: {{ mariadb_resources.requests.memory }}
    limits:
      cpu: {{ mariadb_resources.limits.cpu }}
      memory: {{ mariadb_resources.limits.memory }}

  persistence:
    enabled: true
    storageClass: {{ mariadb_storage_class }}
    size: {{ mariadb_storage_size }}

{% if mariadb_ssl_enabled | default(false) %}
  # TLS/SSL Configuration
  extraVolumes:
    - name: tls
      secret:
        secretName: {{ mariadb_ssl_cert_secret }}
  extraVolumeMounts:
    - name: tls
      mountPath: /opt/bitnami/mariadb/certs
      readOnly: true
  configuration: |-
    [mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    basedir=/opt/bitnami/mariadb
    plugin_dir=/opt/bitnami/mariadb/plugin
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    tmpdir=/opt/bitnami/mariadb/tmp
    max_allowed_packet=16M
    bind-address=*
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error=/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server=UTF8
    collation-server=utf8_general_ci
    slow_query_log=0
    long_query_time=10.0
    # TLS Configuration
    ssl_cert=/opt/bitnami/mariadb/certs/tls.crt
    ssl_key=/opt/bitnami/mariadb/certs/tls.key
    ssl_ca=/opt/bitnami/mariadb/certs/ca.crt
    require_secure_transport=ON

    [client]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set=UTF8
    plugin_dir=/opt/bitnami/mariadb/plugin
    ssl_cert=/opt/bitnami/mariadb/certs/tls.crt
    ssl_key=/opt/bitnami/mariadb/certs/tls.key
    ssl_ca=/opt/bitnami/mariadb/certs/ca.crt

    [manager]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
{% endif %}

metrics:
  enabled: {{ mariadb_metrics_enabled | lower }}
  serviceMonitor:
    enabled: {{ mariadb_metrics_enabled | lower }}

# Network policy
networkPolicy:
  enabled: false
