---
# Authelia Helm values
# https://www.authelia.com/integration/kubernetes/

image:
  registry: ghcr.io
  repository: authelia/authelia

replicas: {{ authelia_replicas }}

resources:
  requests:
    cpu: {{ authelia_resources.requests.cpu }}
    memory: {{ authelia_resources.requests.memory }}
  limits:
    cpu: {{ authelia_resources.limits.cpu }}
    memory: {{ authelia_resources.limits.memory }}

# Use external configuration
configMap:
  enabled: false
  existingConfigMap: authelia-config

# Secrets
secret:
  existingSecret: authelia-secrets
  jwt:
    key: JWT_TOKEN
  session:
    key: SESSION_SECRET
  storage:
    key: STORAGE_ENCRYPTION_KEY
{% if authelia_redis_enabled %}
  redis:
    key: REDIS_PASSWORD
{% endif %}
{% if authelia_storage_backend == 'postgres' %}
  storagePostgresql:
    key: STORAGE_POSTGRES_PASSWORD
{% endif %}

# Disable default ingress (we use HTTPRoute)
ingress:
  enabled: false

# Service configuration
service:
  port: 9091
  type: ClusterIP

# Pod configuration
pod:
  kind: Deployment
  extraVolumeMounts:
    - name: config
      mountPath: /config/configuration.yml
      subPath: configuration.yml
      readOnly: true
{% if authelia_default_users_enabled %}
    - name: users
      mountPath: /config/users_database.yml
      subPath: users_database.yml
      readOnly: true
{% endif %}
{% if authelia_oidc_enabled | default(false) %}
    - name: oidc-secrets
      mountPath: /secrets
      readOnly: true
{% endif %}
  extraVolumes:
    - name: config
      configMap:
        name: authelia-config
{% if authelia_default_users_enabled %}
    - name: users
      configMap:
        name: authelia-users
{% endif %}
{% if authelia_oidc_enabled | default(false) %}
    - name: oidc-secrets
      secret:
        secretName: authelia-secrets
        items:
          - key: OIDC_HMAC_SECRET
            path: OIDC_HMAC_SECRET
          - key: OIDC_PRIVATE_KEY
            path: OIDC_PRIVATE_KEY
{% endif %}

# Enable metrics for Prometheus
metrics:
  enabled: {{ authelia_metrics_enabled | lower }}
  port: {{ authelia_metrics_port }}
  serviceMonitor:
    enabled: {{ authelia_metrics_enabled | lower }}
