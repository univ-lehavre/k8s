# HashiCorp Vault Helm Values
# Generated by Ansible

global:
  enabled: true
  tlsDisable: {{ vault_tls_disable | lower }}

injector:
  enabled: {{ vault_injector_enabled | lower }}
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

server:
  enabled: true

  resources:
    requests:
      cpu: {{ vault_resources.requests.cpu }}
      memory: {{ vault_resources.requests.memory }}
    limits:
      cpu: {{ vault_resources.limits.cpu }}
      memory: {{ vault_resources.limits.memory }}

{% if vault_ha_enabled %}
  ha:
    enabled: true
    replicas: {{ vault_replicas }}
    raft:
      enabled: true
      setNodeId: true
      config: |
        ui = true
        listener "tcp" {
          tls_disable = 1
          address = "[::]:8200"
          cluster_address = "[::]:8201"
        }
        storage "raft" {
          path = "/vault/data"
{% for i in range(vault_replicas | int) %}
          retry_join {
            leader_api_addr = "http://vault-{{ i }}.vault-internal:8200"
          }
{% endfor %}
        }
        service_registration "kubernetes" {}
{% else %}
  standalone:
    enabled: true
    config: |
      ui = true
      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }
      storage "file" {
        path = "/vault/data"
      }
{% endif %}

  dataStorage:
    enabled: true
    size: {{ vault_storage_size }}
    storageClass: {{ vault_storage_class }}

  auditStorage:
    enabled: {{ vault_audit_enabled | lower }}
    size: 5Gi
    storageClass: {{ vault_storage_class }}

ui:
  enabled: {{ vault_ui_enabled | lower }}
  serviceType: ClusterIP
