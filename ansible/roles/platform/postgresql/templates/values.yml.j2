# PostgreSQL HA Helm Values
# Generated by Ansible

global:
  postgresql:
    username: {{ postgresql_username }}
    database: {{ postgresql_database }}
    existingSecret: postgresql-credentials

postgresql:
  replicaCount: {{ postgresql_replicas }}

  image:
    tag: {{ postgresql_version }}

{% if postgresql_ssl_enabled | default(false) %}
  # TLS/SSL Configuration
  tls:
    enabled: true
    certificatesSecret: {{ postgresql_ssl_cert_secret }}
    certFilename: tls.crt
    certKeyFilename: tls.key
{% endif %}

  resources:
    requests:
      cpu: {{ postgresql_resources.requests.cpu }}
      memory: {{ postgresql_resources.requests.memory }}
    limits:
      cpu: {{ postgresql_resources.limits.cpu }}
      memory: {{ postgresql_resources.limits.memory }}

  persistence:
    enabled: true
    storageClass: {{ postgresql_storage_class }}
    size: {{ postgresql_storage_size }}

pgpool:
  replicaCount: {{ postgresql_pgpool_replicas }}
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

metrics:
  enabled: {{ postgresql_metrics_enabled | lower }}
  serviceMonitor:
    enabled: {{ postgresql_metrics_enabled | lower }}

# Witness settings for HA
witness:
  replicaCount: 1

# Pod Disruption Budget
pdb:
  create: {{ ha_enabled | default(false) | lower }}
  minAvailable: 2

# Network policy
networkPolicy:
  enabled: false
