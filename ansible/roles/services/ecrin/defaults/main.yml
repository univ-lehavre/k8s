# ECRIN defaults

# Namespace
ecrin_namespace: ecrin

# Image settings (GitHub Container Registry)
ecrin_image: ghcr.io/univ-lehavre/atlas-ecrin
ecrin_image_tag: "{{ helm_versions.ecrin }}"

# Container port (SvelteKit Node adapter)
ecrin_container_port: 3000

# Resources
ecrin_resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Ingress settings
ecrin_ingress_enabled: true
ecrin_ingress_host: "ecrin.{{ domain }}"
ecrin_ingress_tls_secret: ecrin-tls
ecrin_ingress_issuer: "{{ tls_issuer }}"

# Forward Auth (Keycloak/Authelia via Envoy Gateway SecurityPolicy)
ecrin_forward_auth_enabled: true

# OIDC settings (Keycloak or Authelia)
ecrin_oidc_enabled: true
ecrin_oidc_authority: >-
  {{ 'https://' + keycloak_host + '/realms/' + keycloak_realm
     if keycloak_enabled | default(false)
     else 'https://login.' + domain }}
ecrin_oidc_client_id: ecrin
ecrin_oidc_redirect_uri: "https://ecrin.{{ domain }}/auth/callback"
ecrin_oidc_client_secret: >-
  {{ secrets.keycloak.oidc_ecrin_secret | default('')
     if keycloak_enabled | default(false)
     else authelia_oidc_ecrin_secret }}

# REDCap integration (external service)
ecrin_redcap_url: "{{ lookup('env', 'ECRIN_REDCAP_URL') | default('') }}"
ecrin_redcap_token: "{{ lookup('env', 'ECRIN_REDCAP_TOKEN') | default('') }}"
