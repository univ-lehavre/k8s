---
# Disallow hostPath volumes
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: disallow-host-path
  annotations:
    policies.kyverno.io/title: Disallow hostPath Volumes
    policies.kyverno.io/category: Pod Security Standards (Baseline)
    policies.kyverno.io/severity: high
    policies.kyverno.io/description: >-
      HostPath volumes let Pods use host directories and volumes.
      Using host resources can be used to access shared data or escalate
      privileges. This policy ensures no hostPath volumes are in use.
spec:
  validationFailureAction: {{ kyverno_validation_failure_action }}
  background: {{ kyverno_background_scan | lower }}
  rules:
    - name: host-path
      match:
        any:
          - resources:
              kinds:
                - Pod
      exclude:
        any:
          - resources:
              namespaces:
{% for ns in kyverno_excluded_namespaces %}
                - {{ ns }}
{% endfor %}
      validate:
        message: "HostPath volumes are disallowed."
        pattern:
          spec:
            =(volumes):
              - X(hostPath): "null"
