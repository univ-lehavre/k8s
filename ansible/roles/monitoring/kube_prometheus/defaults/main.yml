# Kube-Prometheus Stack defaults

# Namespace
prometheus_namespace: monitoring

# Helm chart settings
prometheus_chart_repo: https://prometheus-community.github.io/helm-charts
prometheus_chart_repo_name: prometheus-community

# Storage
prometheus_storage_class: "{{ storage_class }}"
prometheus_storage_size: 50Gi
alertmanager_storage_size: 10Gi

# Retention
prometheus_retention: 15d
prometheus_retention_size: 45GB

# Resources
prometheus_resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 2Gi

alertmanager_resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 256Mi

grafana_resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Secrets from CI/CD
grafana_admin_password: "{{ secrets.grafana.admin_password | default(omit) }}"

# Grafana settings
grafana_admin_user: admin

# Ingress settings
grafana_ingress_enabled: true
grafana_ingress_host: "grafana.{{ domain }}"
grafana_ingress_tls_secret: grafana-tls
grafana_ingress_issuer: "{{ tls_issuer }}"

# Forward Auth (Keycloak via Envoy Gateway SecurityPolicy)
grafana_forward_auth_enabled: true

prometheus_ingress_enabled: false
prometheus_ingress_host: "prometheus.{{ domain }}"

alertmanager_ingress_enabled: false
alertmanager_ingress_host: "alertmanager.{{ domain }}"

# Authentication mode: 'oidc' or 'proxy' (SSO provider headers)
grafana_auth_mode: proxy

# Proxy auth settings (SSO provider headers)
# Maps SSO groups to Grafana roles
grafana_proxy_auth_enabled: "{{ grafana_auth_mode == 'proxy' }}"
grafana_proxy_header_name: Remote-User
grafana_proxy_header_email: Remote-Email
grafana_proxy_header_groups: Remote-Groups
grafana_proxy_auto_sign_up: true

# Role mapping from SSO groups
# admins → Admin, devops → Editor, others → Viewer
grafana_role_mapping:
  admin_groups:
    - admins
  editor_groups:
    - devops
    - developers
  viewer_groups:
    - researchers
    - users
  # Default role for authenticated users not in any specific group
  default_role: Viewer

# OIDC settings (Keycloak) - alternative to proxy auth
grafana_oidc_enabled: "{{ grafana_auth_mode == 'oidc' }}"
grafana_oidc_name: Keycloak
grafana_oidc_auth_url: "https://{{ keycloak_host }}/realms/{{ keycloak_realm }}/protocol/openid-connect/auth"
grafana_oidc_token_url: "https://{{ keycloak_host }}/realms/{{ keycloak_realm }}/protocol/openid-connect/token"
grafana_oidc_api_url: "https://{{ keycloak_host }}/realms/{{ keycloak_realm }}/protocol/openid-connect/userinfo"
grafana_oidc_client_id: grafana

# Alertmanager settings
alertmanager_enabled: true
alertmanager_replicas: 1

# Additional scrape configs
prometheus_additional_scrape_configs: []
