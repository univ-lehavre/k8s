---
# Prerequisites role defaults

# Packages to install on all systems
prerequisites_packages:
  - curl
  - wget
  - git
  - vim
  - jq
  - unzip
  - gnupg
  - ca-certificates
  - apt-transport-https
  - software-properties-common

# Additional packages for Longhorn (staging/prod)
prerequisites_longhorn_packages:
  - open-iscsi
  - nfs-common

# Sysctl settings for Kubernetes
prerequisites_sysctl:
  # Network settings
  net.bridge.bridge-nf-call-iptables: 1
  net.bridge.bridge-nf-call-ip6tables: 1
  net.ipv4.ip_forward: 1
  net.ipv6.conf.all.forwarding: 1

  # Memory settings
  vm.swappiness: 0
  vm.overcommit_memory: 1

  # File descriptors
  fs.file-max: 2097152
  fs.inotify.max_user_watches: 524288
  fs.inotify.max_user_instances: 512

  # Cilium eBPF
  net.core.bpf_jit_enable: 1

# Kernel modules to load
prerequisites_kernel_modules:
  - overlay
  - br_netfilter

# Whether to disable swap
prerequisites_disable_swap: true

# Directories to create
prerequisites_directories:
  - /etc/rancher/k3s
  - /var/log/kubernetes
  - /var/lib/longhorn
