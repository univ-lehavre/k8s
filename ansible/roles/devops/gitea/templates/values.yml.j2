# Gitea Helm Values
# Generated by Ansible

replicaCount: 1

resources:
  requests:
    cpu: {{ gitea_resources.requests.cpu }}
    memory: {{ gitea_resources.requests.memory }}
  limits:
    cpu: {{ gitea_resources.limits.cpu }}
    memory: {{ gitea_resources.limits.memory }}

persistence:
  enabled: true
  storageClass: {{ gitea_storage_class }}
  size: {{ gitea_storage_size }}

# Gitea configuration
gitea:
  admin:
    username: {{ gitea_admin_user }}
    password: "{{ gitea_admin_password }}"
    email: {{ gitea_admin_email }}

  config:
    APP_NAME: "{{ organization_name | default('ATLAS') }} Git"
    RUN_MODE: prod

    server:
      DOMAIN: {{ gitea_ingress_host }}
      ROOT_URL: "https://{{ gitea_ingress_host }}/"
      SSH_DOMAIN: {{ gitea_ingress_host }}
      SSH_PORT: {{ gitea_ssh_port }}
      SSH_LISTEN_PORT: 22
      LFS_START_SERVER: {{ gitea_lfs_enabled | lower }}

    database:
      DB_TYPE: postgres
      HOST: {{ gitea_postgresql_host }}:{{ gitea_postgresql_port }}
      NAME: {{ gitea_postgresql_database }}
      USER: {{ gitea_postgresql_user }}
      PASSWD: "{{ postgresql_superuser_password }}"

    cache:
      ENABLED: true
      ADAPTER: redis
      HOST: "redis://:{{ redis_password }}@{{ gitea_redis_host }}:{{ gitea_redis_port }}/0"

    session:
      PROVIDER: redis
      PROVIDER_CONFIG: "redis://:{{ redis_password }}@{{ gitea_redis_host }}:{{ gitea_redis_port }}/1"

    queue:
      TYPE: redis
      CONN_STR: "redis://:{{ redis_password }}@{{ gitea_redis_host }}:{{ gitea_redis_port }}/2"

    security:
      INSTALL_LOCK: true
      SECRET_KEY: ""  # Will be auto-generated

    service:
      DISABLE_REGISTRATION: true
      REQUIRE_SIGNIN_VIEW: false
      DEFAULT_ALLOW_CREATE_ORGANIZATION: false

{% if gitea_oidc_enabled %}
    oauth2_client:
      OPENID_CONNECT_SCOPES: openid profile email
      ENABLE_AUTO_REGISTRATION: true
      USERNAME: nickname
{% endif %}

# Disable built-in PostgreSQL and Redis
postgresql:
  enabled: false

redis-cluster:
  enabled: false

# Ingress disabled (managed separately)
ingress:
  enabled: false

# Metrics
metrics:
  enabled: {{ monitoring_enabled | default(true) | lower }}
  serviceMonitor:
    enabled: {{ monitoring_enabled | default(true) | lower }}
